<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Python 项目演示模板</title>
    <!-- 引入 Tailwind CSS 进行快速布局 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入 JetBrains Mono 字体，适合代码展示 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-color: #0f172a;
            --code-bg: #1e293b;
            --accent: #38bdf8;
            --text-dim: #64748b;
            --text-light: #f1f5f9;
            --line-height: 1.6rem;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-light);
            overflow: hidden; /* 防止页面整体滚动 */
        }

        .code-font {
            font-family: 'JetBrains Mono', monospace;
        }

        /* 滚动条美化 */
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background-color: #334155;
            border-radius: 4px;
        }

        /* 代码行的动画效果 */
        .code-line {
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            padding: 0 1rem;
            border-left: 2px solid transparent;
            opacity: 1;
            transform-origin: left center;
            white-space: pre; /* 保留空格 */
            display: flex;
        }

        .line-number {
            display: inline-block;
            width: 2rem;
            color: var(--text-dim);
            text-align: right;
            margin-right: 1rem;
            user-select: none;
        }

        /* 聚焦状态 */
        .code-line.active {
            opacity: 1;
            background-color: rgba(56, 189, 248, 0.1);
            border-left: 2px solid var(--accent);
            transform: scale(1.02) translateX(10px);
            color: #fff;
            text-shadow: 0 0 10px rgba(56, 189, 248, 0.3);
            filter: blur(0);
        }

        /* 非聚焦状态 */
        .code-line.inactive {
            opacity: 0.25;
            filter: blur(1.5px);
            transform: scale(0.98);
        }

        /* 语法高亮 (简单的模拟) */
        .syntax-keyword { color: #c678dd; font-weight: bold; } /* def, class, return */
        .syntax-string { color: #98c379; } /* "string" */
        .syntax-comment { color: #5c6370; font-style: italic; } /* # comment */
        .syntax-func { color: #61afef; } /* function_name */
        .syntax-class { color: #e5c07b; } /* ClassName */
        .syntax-decorator { color: #d19a66; } /* @decorator */

        /* 说明卡片动画 */
        .info-card {
            transition: opacity 0.4s ease, transform 0.4s ease;
        }
        .fade-in-up {
            animation: fadeInUp 0.5s ease forwards;
        }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="h-screen flex flex-col md:flex-row">

    <!-- 左侧：代码视窗 -->
    <div class="w-full md:w-2/3 h-1/2 md:h-full relative flex flex-col bg-slate-900 border-r border-slate-700 shadow-2xl">
        <!-- 顶部 Mac 风格装饰栏 -->
        <div class="h-10 bg-slate-800 flex items-center px-4 space-x-2 border-b border-slate-700 z-10 shrink-0">
            <div class="w-3 h-3 rounded-full bg-red-500"></div>
            <div class="w-3 h-3 rounded-full bg-yellow-500"></div>
            <div class="w-3 h-3 rounded-full bg-green-500"></div>
            <span class="ml-4 text-xs text-slate-400 font-mono" id="filename-display">main.py</span>
        </div>

        <!-- 代码滚动容器 -->
        <div id="code-container" class="flex-1 overflow-y-auto custom-scrollbar p-6 code-font text-sm md:text-base leading-7 scroll-smooth">
            <!-- 代码将由 JS 注入到这里 -->
        </div>
        
        <!-- 进度条 -->
        <div class="h-1 bg-slate-800 w-full shrink-0">
            <div id="progress-bar" class="h-full bg-sky-500 transition-all duration-300" style="width: 0%"></div>
        </div>
    </div>

    <!-- 右侧：控制与讲解区 -->
    <div class="w-full md:w-1/3 h-1/2 md:h-full bg-slate-950 p-8 flex flex-col justify-between relative overflow-hidden">
        
        <!-- 背景装饰 -->
        <div class="absolute top-0 right-0 w-64 h-64 bg-sky-500/10 rounded-full blur-3xl -mr-16 -mt-16 pointer-events-none"></div>

        <div>
            <h1 class="text-2xl font-bold text-white mb-2 tracking-tight">Project Explorer</h1>
            <p class="text-slate-400 text-sm mb-8">互动式代码演示</p>

            <!-- 动态说明卡片 -->
            <div id="info-panel" class="bg-slate-900/50 border border-slate-700 p-6 rounded-xl shadow-lg backdrop-blur-sm min-h-[200px]">
                <div class="flex items-center space-x-2 mb-4">
                    <span id="step-badge" class="px-2 py-0.5 rounded text-xs font-bold bg-sky-500/20 text-sky-400 border border-sky-500/30">INTRODUCTION</span>
                </div>
                <h2 id="step-title" class="text-xl font-semibold text-sky-100 mb-3">准备开始</h2>
                <p id="step-desc" class="text-slate-300 leading-relaxed text-sm">
                    点击下方的“开始演示”按钮，我们将逐步解析这个 Python 项目的核心逻辑。
                </p>
            </div>
        </div>

        <!-- 控制按钮 -->
        <div class="mt-8 z-10">
            <div class="flex space-x-4">
                <button onclick="prevStep()" class="flex-1 px-4 py-3 rounded-lg bg-slate-800 hover:bg-slate-700 text-slate-300 transition border border-slate-600 font-medium text-sm flex items-center justify-center gap-2 group">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="group-hover:-translate-x-1 transition-transform"><path d="m15 18-6-6 6-6"/></svg>
                    上一步
                </button>
                <button onclick="nextStep()" class="flex-1 px-4 py-3 rounded-lg bg-sky-600 hover:bg-sky-500 text-white transition font-medium text-sm shadow-lg shadow-sky-900/50 flex items-center justify-center gap-2 group">
                    下一步
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="group-hover:translate-x-1 transition-transform"><path d="m9 18 6-6-6-6"/></svg>
                </button>
            </div>
            <div class="text-center mt-4">
                <button onclick="resetDemo()" class="text-xs text-slate-500 hover:text-slate-300 transition">重置演示</button>
            </div>
        </div>
    </div>

    <script>
        // ==========================================
        // 1. 在这里配置你的 Python 代码
        // ==========================================
        const projectTitle = "DataProcessor.py";
        const pythonCode = `import time
from dataclasses import dataclass
from typing import List

# 定义一个数据模型
@dataclass
class UserData:
    id: int
    username: str
    is_active: bool = True

class BatchProcessor:
    """ 模拟一个批量数据处理器 """
    
    def __init__(self, batch_size: int = 5):
        self.batch_size = batch_size
        self.queue: List[UserData] = []
        print(f"Processor initialized with batch size: {batch_size}")

    def add_user(self, user: UserData):
        """ 添加用户到队列，如果满了就处理 """
        self.queue.append(user)
        self.log(f"User {user.username} added.")
        
        if len(self.queue) >= self.batch_size:
            self._flush_queue()

    def _flush_queue(self):
        """ 处理当前队列中的所有数据 """
        print(f"--> Flushing {len(self.queue)} items...")
        
        # 模拟耗时操作 (例如写入数据库)
        for user in self.queue:
            self.process_single(user)
            
        self.queue.clear()
        print("--> Batch complete.")

    def process_single(self, user):
        # 简单的逻辑处理
        if user.is_active:
            print(f"Saving active user: {user.id}")
        else:
            print(f"Skipping inactive user: {user.id}")

    def log(self, msg):
        timestamp = time.strftime("%H:%M:%S")
        print(f"[{timestamp}] {msg}")

# 运行演示
if __name__ == "__main__":
    processor = BatchProcessor(batch_size=2)
    processor.add_user(UserData(1, "Alice"))
    processor.add_user(UserData(2, "Bob", False)) # 这会触发 Flush`;

        // ==========================================
        // 2. 在这里配置演示步骤
        // range: [开始行号, 结束行号] (从1开始)
        // ==========================================
        const steps = [
            {
                range: null, // null 表示显示全部，不聚焦
                title: "项目概览",
                desc: "这是一个简单的 Python 批处理系统模拟。它演示了类设计、类型提示 (Type Hints) 和队列管理逻辑。让我们开始深入代码细节。",
                badge: "OVERVIEW"
            },
            {
                range: [1, 3],
                title: "导入依赖",
                desc: "我们首先导入必要的标准库。`dataclass` 用于快速构建数据类，`typing` 用于让代码更规范、易读。",
                badge: "IMPORTS"
            },
            {
                range: [6, 10],
                title: "数据模型 (Data Class)",
                desc: "使用 `@dataclass` 装饰器定义 `UserData`。这比传统的 `__init__` 写法更简洁，自动帮我们生成初始化方法和 `__repr__`。",
                badge: "MODEL"
            },
            {
                range: [12, 18],
                title: "处理器初始化",
                desc: "`BatchProcessor` 类负责业务逻辑。我们在 `__init__` 中设置了批次大小 (`batch_size`) 并初始化了一个空列表作为缓冲区。",
                badge: "INIT"
            },
            {
                range: [20, 26],
                title: "核心逻辑：添加用户",
                desc: "`add_user` 方法是外部调用的入口。它将用户加入队列，并检查是否达到了 `batch_size` 阈值。如果达到了，就触发 `_flush_queue`。",
                badge: "CORE LOGIC"
            },
            {
                range: [28, 38],
                title: "私有方法：刷新队列",
                desc: "`_flush_queue` 处理实际的业务。它遍历当前队列，逐个处理用户，最后清空队列等待下一批数据。",
                badge: "PRIVATE METHOD"
            },
            {
                range: [52, 55],
                title: "实际运行",
                desc: "在主程序入口，我们实例化处理器（设置容量为2），并添加两个用户。注意：添加第二个用户时，因为满足了批次大小，会自动触发处理逻辑。",
                badge: "EXECUTION"
            }
        ];

        // ==========================================
        // 3. 核心逻辑 (渲染与交互)
        // ==========================================
        
        let currentStepIndex = 0;
        const codeContainer = document.getElementById('code-container');
        const filenameDisplay = document.getElementById('filename-display');
        
        // 简单的语法高亮函数
        function highlightSyntax(line) {
            let html = line
                .replace(/</g, "&lt;").replace(/>/g, "&gt;") // 转义 HTML
                .replace(/#.*/g, '<span class="syntax-comment">$&</span>') // 注释
                .replace(/(['"])(?:(?!\1|\\).|\\.)*\1/g, '<span class="syntax-string">$&</span>') // 字符串
                .replace(/\b(import|from|class|def|return|if|else|self|print)\b/g, '<span class="syntax-keyword">$1</span>') // 关键字
                .replace(/@\w+/g, '<span class="syntax-decorator">$&</span>'); // 装饰器

            // 函数名和类名的高亮尝试 (简单正则)
            html = html.replace(/(class\s+)(\w+)/, '$1<span class="syntax-class">$2</span>');
            html = html.replace(/(def\s+)(\w+)/, '$1<span class="syntax-func">$2</span>');
            
            return html;
        }

        // 初始化渲染代码
        function renderCode() {
            filenameDisplay.innerText = projectTitle;
            const lines = pythonCode.split('\n');
            codeContainer.innerHTML = '';

            lines.forEach((line, index) => {
                const lineDiv = document.createElement('div');
                lineDiv.className = 'code-line inactive'; // 默认非激活
                lineDiv.id = `line-${index + 1}`;
                
                // 行号
                const lineNum = document.createElement('span');
                lineNum.className = 'line-number';
                lineNum.innerText = index + 1;
                
                // 代码内容
                const codeContent = document.createElement('span');
                codeContent.innerHTML = highlightSyntax(line);
                
                lineDiv.appendChild(lineNum);
                lineDiv.appendChild(codeContent);
                codeContainer.appendChild(lineDiv);
            });
            
            updateView();
        }

        // 更新视图状态
        function updateView() {
            const step = steps[currentStepIndex];
            const lines = document.querySelectorAll('.code-line');
            
            // 1. 更新右侧说明面板
            const infoPanel = document.getElementById('info-panel');
            const stepTitle = document.getElementById('step-title');
            const stepDesc = document.getElementById('step-desc');
            const stepBadge = document.getElementById('step-badge');
            
            // 添加淡入动画
            infoPanel.classList.remove('fade-in-up');
            void infoPanel.offsetWidth; // 触发重绘
            infoPanel.classList.add('fade-in-up');

            stepTitle.innerText = step.title;
            stepDesc.innerText = step.desc;
            stepBadge.innerText = step.badge;

            // 2. 更新进度条
            const progress = ((currentStepIndex + 1) / steps.length) * 100;
            document.getElementById('progress-bar').style.width = `${progress}%`;

            // 3. 处理代码高亮与滚动
            let firstActiveLine = null;
            let lastActiveLine = null;

            lines.forEach((line, idx) => {
                const lineNum = idx + 1;
                // 判断当前行是否在范围内
                let isActive = false;
                
                if (step.range) {
                    if (lineNum >= step.range[0] && lineNum <= step.range[1]) {
                        isActive = true;
                    }
                } else {
                    // 如果 range 为 null，显示概览模式（所有代码半亮或全亮，这里选择全亮但不大）
                    line.className = 'code-line active';
                    line.style.transform = 'scale(1)';
                    line.style.filter = 'blur(0)';
                    return; 
                }

                if (isActive) {
                    line.className = 'code-line active';
                    if (!firstActiveLine) firstActiveLine = line;
                    lastActiveLine = line;
                } else {
                    line.className = 'code-line inactive';
                }
            });

            // 4. 自动滚动逻辑
            if (step.range && firstActiveLine) {
                // 计算中心位置
                const containerHeight = codeContainer.clientHeight;
                const lineTop = firstActiveLine.offsetTop;
                const lineHeight = firstActiveLine.offsetHeight;
                const activeHeight = (step.range[1] - step.range[0] + 1) * lineHeight;
                
                // 目标滚动位置：让代码块居中
                const targetScroll = lineTop - (containerHeight / 2) + (activeHeight / 2);

                codeContainer.scrollTo({
                    top: targetScroll,
                    behavior: 'smooth'
                });
            } else {
                // 概览模式滚回顶部
                codeContainer.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        function nextStep() {
            if (currentStepIndex < steps.length - 1) {
                currentStepIndex++;
                updateView();
            }
        }

        function prevStep() {
            if (currentStepIndex > 0) {
                currentStepIndex--;
                updateView();
            }
        }

        function resetDemo() {
            currentStepIndex = 0;
            updateView();
        }

        // 键盘导航
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowRight' || e.key === 'ArrowDown' || e.key === ' ') {
                nextStep();
            } else if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') {
                prevStep();
            }
        });

        // 启动
        window.onload = renderCode;

    </script>
</body>
</html>
